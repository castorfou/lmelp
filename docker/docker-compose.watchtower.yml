# Docker Compose override for Watchtower auto-updates
# Usage: docker compose -f docker-compose.yml -f docker-compose.watchtower.yml up -d

services:
  # Watchtower - Auto-update containers when new images are available
  watchtower:
    image: containrrr/watchtower:latest
    container_name: lmelp-watchtower
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      # Check for updates every 6 hours (21600 seconds)
      - WATCHTOWER_POLL_INTERVAL=21600
      # Only monitor lmelp containers
      - WATCHTOWER_SCOPE=lmelp
      # Clean up old images after update
      - WATCHTOWER_CLEANUP=true
      # Include stopped containers
      - WATCHTOWER_INCLUDE_STOPPED=true
      # Log level (debug, info, warn, error)
      - WATCHTOWER_LOG_LEVEL=info
      # Notification URL (optional - uncomment and configure if needed)
      # - WATCHTOWER_NOTIFICATION_URL=smtp://username:password@smtp.gmail.com:587/?fromAddress=from@gmail.com&toAddresses=to@gmail.com
    labels:
      - "com.centurylinklabs.watchtower.scope=lmelp"
    networks:
      - lmelp-network

  # Add watchtower scope label to app container
  app:
    labels:
      - "com.centurylinklabs.watchtower.scope=lmelp"
      - "com.centurylinklabs.watchtower.enable=true"
